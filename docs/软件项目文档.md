# 慧医健康系统软件项目文档

## 目录
1. [项目概述](#1-项目概述)
2. [需求分析](#2-需求分析)
3. [概要设计](#3-概要设计)
4. [详细设计](#4-详细设计)
5. [数据库设计](#5-数据库设计)
6. [接口设计](#6-接口设计)
7. [安全设计](#7-安全设计)
8. [部署方案](#8-部署方案)

## 1. 项目概述

### 1.1 项目背景
慧医健康系统旨在解决传统医疗预约流程繁琐、效率低下的问题，通过信息化手段提升医疗服务质量，优化患者就医体验。

### 1.2 项目目标
- 实现医疗预约全流程线上化
- 提供便捷的病例管理系统
- 优化医生工作流程
- 提升患者就医体验
- 实现医疗资源的高效配置

### 1.3 适用范围
- 综合医院
- 专科医院
- 社区医疗中心
- 健康管理机构

## 2. 需求分析

### 2.1 功能需求

#### 2.1.1 用户管理模块
```ascii
+---------------+           +----------------+
|    患者用户    |           |    医生用户     |
+---------------+           +----------------+
       |                           |
       |   +------------------+    |
       +-->|    用户认证系统    |<---+
           +------------------+
                    |
            +-------------+
            | 权限管理系统  |
            +-------------+
```

1. 用户注册
   - 患者注册
   - 医生信息录入
   - 管理员账号管理

2. 用户认证
   - 账号密码登录
   - JWT令牌认证
   - 角色权限控制

#### 2.1.2 预约管理模块
```ascii
+----------+     +-----------+     +----------+
|  选择科室  |---->| 选择医生  |---->| 选择时间  |
+----------+     +-----------+     +----------+
      |               |                |
      v               v                v
+----------------------------------------+
|              预约记录管理                |
+----------------------------------------+
```

1. 预约功能
   - 科室选择
   - 医生选择
   - 时间段选择
   - 预约确认

2. 预约管理
   - 预约查询
   - 预约修改
   - 预约取消
   - 预约提醒

#### 2.1.3 病例管理模块
```ascii
+-------------+     +------------+     +------------+
|  患者基本信息 |---->| 就诊记录   |---->| 检查结果   |
+-------------+     +------------+     +------------+
                         |                  |
                         v                  v
                  +-------------------------+
                  |      病例完整记录        |
                  +-------------------------+
```

1. 病例记录
   - 基本信息记录
   - 诊断信息记录
   - 检查记录关联
   - 治疗方案记录

2. 病例查询
   - 按时间查询
   - 按科室查询
   - 按医生查询
   - 按状态查询

### 2.2 非功能需求

#### 2.2.1 性能需求
- 系统响应时间：< 1秒
- 并发用户数：>= 1000
- 数据处理能力：>= 10000 TPS
- 系统可用性：>= 99.9%

#### 2.2.2 安全需求
- 数据加密传输
- 敏感信息脱敏
- 访问权限控制
- 操作日志审计

#### 2.2.3 可靠性需求
- 系统备份机制
- 故障恢复能力
- 数据一致性保证
- 系统监控告警

## 3. 概要设计

### 3.1 系统架构
```ascii
+----------------+     +----------------+     +----------------+
|   表现层        |     |    业务层      |     |    数据层      |
+----------------+     +----------------+     +----------------+
| - Web界面      |     | - 用户服务     |     | - MySQL数据库  |
| - 移动端接口    |     | - 预约服务     |     | - Redis缓存   |
| - 安全过滤器    |     | - 病例服务     |     | - 文件存储    |
+----------------+     +----------------+     +----------------+
```

### 3.2 技术架构
- 开发语言：Java
- 框架选型：
  - Spring Boot
  - Spring Security
  - MyBatis-Plus
  - JWT
  - Redis
  - MySQL

### 3.3 部署架构
```ascii
                    +---------------+
                    |  负载均衡层    |
                    +---------------+
                           |
        +------------------+------------------+
        |                  |                 |
+---------------+  +---------------+  +---------------+
|  应用服务器1   |  |  应用服务器2   |  |  应用服务器3   |
+---------------+  +---------------+  +---------------+
        |                  |                 |
        +------------------+------------------+
                           |
                    +---------------+
                    |  数据库集群     |
                    +---------------+
```

## 4. 详细设计

### 4.1 用户管理模块

#### 4.1.1 用户注册流程
```ascii
+-------------+     +----------------+     +----------------+
|  输入用户信息  |---->|  验证信息完整性  |---->|  创建用户账号   |
+-------------+     +----------------+     +----------------+
                           |                      |
                           v                      v
                    +----------------+     +----------------+
                    |  密码加密存储   |<----|  初始化用户角色  |
                    +----------------+     +----------------+
```

核心代码：
```java
public void register(RegisterVO vo) throws Exception {
    // 验证信息
    if (StrUtil.isBlank(vo.getUsername()) || StrUtil.isBlank(vo.getPassword())) {
        throw new Exception("用户名和密码不能为空");
    }
    // 创建用户
    Users users = new Users();
    users.setUsername(vo.getUsername());
    users.setPassword(encoder.encode(vo.getPassword()));
    this.save(users);
}
```

#### 4.1.2 用户认证流程
```ascii
+-------------+     +----------------+     +----------------+
|  用户登录    |---->|  验证用户信息   |---->|  生成JWT令牌   |
+-------------+     +----------------+     +----------------+
                           |                      |
                           v                      v
                    +----------------+     +----------------+
                    |  加载用户角色   |<----|  返回用户信息   |
                    +----------------+     +----------------+
```

### 4.2 预约管理模块

#### 4.2.1 预约创建流程
```ascii
+-----------+     +------------+     +-------------+
| 选择医生  |---->| 选择时间段  |---->| 创建预约记录  |
+-----------+     +------------+     +-------------+
                        |                  |
                        v                  v
                 +------------+     +-------------+
                 | 时间冲突   |     | 生成病例记录  |
                 | 检查      |     |             |
                 +------------+     +-------------+
```

核心代码：
```java
public void increase(CreateAppointmentVO vo, Long userId) {
    // 处理时间信息
    String[] split = vo.getTime().split("-");
    String year = split[0];
    String month = split[1];
    String day = split[2];

    // 创建预约
    Appointments appointments = new Appointments();
    BeanUtil.copyProperties(vo, appointments);
    appointments.setPatientId(patientId.getId());
    appointments.setYear(year);
    appointments.setMonth(month);
    appointments.setDay(day);
    this.save(appointments);

    // 创建关联病例
    Cases cases = new Cases();
    cases.setStatus(false);
    cases.setDoctorId(vo.getDoctorId());
    cases.setPatientId(patientId.getId());
    casesService.save(cases);
}
```

### 4.3 病例管理模块

#### 4.3.1 病例更新流程
```ascii
+------------+     +-------------+     +------------+
| 诊断记录   |---->| 检查项目添加  |---->| 更新状态   |
+------------+     +-------------+     +------------+
                         |                  |
                         v                  v
                  +-------------+     +------------+
                  | 关联检查结果 |     | 完成就诊   |
                  +-------------+     +------------+
```

## 5. 数据库设计

### 5.1 ER图
```ascii
+-------------+     +---------------+     +-------------+
|    Users    |     | Appointments  |     |   Doctors   |
+-------------+     +---------------+     +-------------+
| - id        |     | - id          |     | - id        |
| - username  |     | - patient_id  |     | - name      |
| - password  |     | - doctor_id   |     | - job_type  |
| - role      |     | - time_id     |     | - status    |
+-------------+     +---------------+     +-------------+
       |                   |                    |
       |                   |                    |
+-------------+     +---------------+     +-------------+
|  Patients   |     |    Cases      |     |   Checks   |
+-------------+     +---------------+     +-------------+
| - id        |     | - id          |     | - id        |
| - user_id   |     | - patient_id  |     | - case_id   |
| - name      |     | - doctor_id   |     | - type      |
| - birthday  |     | - status      |     | - result    |
+-------------+     +---------------+     +-------------+
```

### 5.2 主要表结构

#### 5.2.1 Users表
| 字段名     | 类型     | 说明     |
| ---------- | -------- | -------- |
| id         | bigint   | 主键     |
| username   | varchar  | 用户名   |
| password   | varchar  | 密码     |
| role       | varchar  | 角色     |
| status     | boolean  | 状态     |
| email      | varchar  | 邮箱     |
| created_at | datetime | 创建时间 |
| updated_at | datetime | 更新时间 |
| deleted_at | datetime | 删除时间 |

## 6. 接口设计

### 6.1 RESTful API设计

#### 6.1.1 用户管理接口
```
POST /api/user/register     # 用户注册
POST /api/user/login       # 用户登录
GET  /api/user/info        # 获取用户信息
POST /api/user/update      # 更新用户信息
```

#### 6.1.2 预约管理接口
```
POST /api/appointment/increase    # 创建预约
GET  /api/appointment/list       # 预约列表
POST /api/appointment/update     # 更新预约
GET  /api/appointment/delete     # 删除预约
```

### 6.2 接口规范
1. 请求格式
```json
{
    "username": "string",
    "password": "string",
    "email": "string"
}
```

2. 响应格式
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "token": "string",
        "userInfo": {}
    }
}
```

## 7. 安全设计

### 7.1 认证机制
```ascii
+-----------+     +------------+     +-------------+
| JWT令牌   |---->| 权限验证    |---->| 资源访问    |
+-----------+     +------------+     +-------------+
                        |
                        v
                 +------------+
                 | 角色控制   |
                 +------------+
```

### 7.2 数据安全
1. 传输加密
   - HTTPS协议
   - 数据加密传输

2. 存储安全
   - 密码加密存储
   - 敏感数据脱敏

## 8. 部署方案

### 8.1 环境要求
- JDK 17+
- MySQL 8.0+
- Redis 6.0+
- Nginx 1.18+

### 8.2 部署流程
```ascii
+---------------+     +----------------+     +----------------+
|  编译打包     |---->|  环境配置      |---->|  服务部署      |
+---------------+     +----------------+     +----------------+
                            |                       |
                            v                       v
                     +----------------+     +----------------+
                     |  数据库初始化   |     |  服务启动      |
                     +----------------+     +----------------+
```

### 8.3 监控方案
1. 系统监控
   - CPU使用率
   - 内存使用率
   - 磁盘使用率
   - 网络流量

2. 应用监控
   - 接口响应时间
   - 并发用户数
   - 错误率统计
   - 业务指标监控
